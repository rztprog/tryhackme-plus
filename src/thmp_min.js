"use strict";const maxAttempts=50,darkBlueColor="#151c2b";let sticky=!0,activeMachine=null,header1=null,scrollHandler=null,resizeHandler=null;chrome.storage.local.get(["sticky"],e=>{sticky="boolean"!=typeof e.sticky||e.sticky});const switcher=(e,t)=>{let l=document.getElementById("split-screen-middle"),i=document.getElementById("room_content"),r=window.getComputedStyle(i),n=l.scrollTop;if(scrollHandler&&l.removeEventListener("scroll",scrollHandler),resizeHandler&&window.removeEventListener("resize",resizeHandler),"\uD83D\uDCCC"===e.innerText){let s=()=>{t.style.position="fixed",t.style.backgroundColor=darkBlueColor,t.style.maxWidth="1296px",t.style.width=r.width,t.style.padding="10px",t.style.top="16px",t.style.marginRight="1.7rem"},o=()=>{t.style.position="",t.style.backgroundColor="",t.style.width="",t.style.maxWidth="",t.style.padding="",t.style.top="",t.style.marginRight=""};scrollHandler=()=>{sticky&&((n=l.scrollTop)>408&&window.innerWidth<1023||n>390&&window.innerWidth>1023?s():o())},resizeHandler=()=>{sticky&&(t.style.width=window.getComputedStyle(i).width)},l.addEventListener("scroll",scrollHandler),window.addEventListener("resize",resizeHandler),scrollHandler()}else t.style.position="",t.style.backgroundColor="",t.style.width="",t.style.maxWidth="",t.style.padding="",t.style.top="",t.style.marginRight="",activeMachine&&(header1.style.marginTop="",activeMachine.style.position="",activeMachine.style.width="",activeMachine.style.maxWidth="",activeMachine.style.zIndex="",activeMachine.style.top="",activeMachine.style.padding="",activeMachine.style.marginRight="",activeMachine.style.border="",activeMachine=null),scrollHandler&&l.removeEventListener("scroll",scrollHandler),resizeHandler&&window.removeEventListener("resize",resizeHandler),scrollHandler=null,resizeHandler=null},targetMachine=()=>{let e=0,t=setInterval(()=>{let l=document.getElementById("active-machine-info");if(l){let i=document.getElementById("split-screen-middle"),r=document.getElementById("room_content"),n=window.getComputedStyle(r);header1=document.getElementById("header-1");let s=i.scrollTop;activeMachine=l,s>500&&sticky&&(header1.style.marginTop="120px",l.style.position="fixed",l.style.maxWidth="1296px",l.style.width=n.width,l.style.zIndex="999",window.innerWidth>1177?l.style.top="72px":l.style.top="120px",window.innerWidth<712&&(l.style.top="168px"),l.style.padding="10px",l.style.marginRight="1.7rem",l.style.border=`1px solid ${darkBlueColor}`),i.addEventListener("scroll",()=>{sticky&&((s=i.scrollTop)>500&&window.innerWidth>1023||s>550&&window.innerWidth<1023?(window.addEventListener("resize",()=>{l.style.width=n.width,window.innerWidth>1177?l.style.top="72px":l.style.top="120px",window.innerWidth<712&&(l.style.top="168px")}),header1.style.marginTop="120px",l.style.position="fixed",l.style.maxWidth="1296px",l.style.width=n.width,l.style.zIndex="999",window.innerWidth>1177?l.style.top="72px":l.style.top="120px",window.innerWidth<712&&(l.style.top="168px"),l.style.padding="10px",l.style.marginRight="1.7rem",l.style.border=`1px solid ${darkBlueColor}`):(header1.style.marginTop="",l.style.position="",l.style.width="",l.style.maxWidth="",l.style.zIndex="",l.style.top="",l.style.padding="",l.style.marginRight="",l.style.border=""))}),clearInterval(t);return}if(++e>=50){activeMachine=null,clearInterval(t);return}},200)},addButton=e=>{if(!document.querySelector(".lock-scroll-button")&&e.includes("room")){let t=0,l=setInterval(()=>{let e=document.querySelector('[data-sentry-component="RoomBannerActions"]');if(e){let i=e.lastElementChild;if(!i||!i.classList.contains("lock-scroll-button")){let r=`
              <button color="secondary" type="button" role="button" style="border-color: rgb(62, 71, 90);"class="eyZCEe eCoJpk bpvDXh lock-scroll-button" aria-label="lock-scroll-button">
              </button>
            `,n=document.createElement("div");n.innerHTML=r;let s=n.firstElementChild;s.innerText=sticky?"\uD83D\uDCCC":"\uD83D\uDD12",switcher(s,e),s.addEventListener("click",()=>{"\uD83D\uDCCC"==s.innerText?(chrome.storage.local.set({sticky:!1}),s.innerText="\uD83D\uDD12",sticky=!1):(chrome.storage.local.set({sticky:!0}),s.innerText="\uD83D\uDCCC",sticky=!0),switcher(s,e)}),e.appendChild(s),clearInterval(l);return}}++t>=50&&clearInterval(l)},200)}};document.addEventListener("click",e=>{"button"===e.target.type&&"Loading..."===e.target.innerText.trim()&&targetMachine()}),document.addEventListener("click",e=>{let t=0,l=document.querySelector('[data-testid="start-attack-box-btn"]');if(e.target==l){let i=setInterval(()=>{let e=document.querySelector("#right-panel");e&&(panelObserver(e),console.log("loaded wait"),setTimeout(()=>{console.log("LAUNCH");let e=document.querySelector(".lock-scroll-button"),t=document.querySelector('[data-sentry-component="RoomBannerActions"]');switcher(e,t),targetMachine()},600),clearInterval(i)),++t>=50&&clearInterval(i)},200)}});const panelObserver=e=>{let t=new MutationObserver(e=>{for(let t of e)if("attributes"===t.type&&"data-panel-size"===t.attributeName){let l=document.querySelector(".lock-scroll-button"),i=document.querySelector('[data-sentry-component="RoomBannerActions"]');l&&i&&"function"==typeof switcher&&(switcher(l,i),targetMachine())}});t.observe(e,{attributes:!0,attributeFilter:["data-panel-size"]})},rightPanel=()=>{let e=0,t=setInterval(()=>{let l=document.querySelector("#right-panel");l&&(panelObserver(l),clearInterval(t)),++e>=50&&clearInterval(t)},200)};document.addEventListener("click",e=>{let t=e.target.closest("a"),l=t?t.href:null;addButton(l),targetMachine(),rightPanel()}),location.href.includes("room")&&(addButton(location.href),targetMachine(),rightPanel());